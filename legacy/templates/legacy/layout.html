{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Byte of Legacy{% endblock %}</title>
    <link rel="shortcut icon" href="{% static 'legacy/favicon/byte of legacy copy.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'legacy/styles/main_style.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    {% block extra_heads %}{% endblock %}

    <style>
        body, .bol-legacy-card {
            background-image: url("{% static 'legacy/favicon/Rectangle 1 copy.png' %}");
        }
    </style>
</head>
<body>
    <div class="bol-fluid-container bol-header-height">        
        <div class="bol-container bol-header">
            <nav class="bol-navbar">
                <a href="{% url 'legacy:index' %}" class="bol-navbar-brand">
                    <img src="{% static 'legacy/favicon/Group 1 copy.png' %}" alt="Byte of Legacy" id="bol-nav-logo">
                </a>
                <ul class="bol-navbar-nav">
                    <li class="bol-nav-item"><a href="{% url 'legacy:about' %}" class="bol-nav-link">About</a></li>
                    <li class="bol-nav-item"><a href="{% url 'legacy:claim' %}" class="bol-nav-link" style="background-color: #2A9DF4;">Claim a Byte!</a></li>
                </ul>
            </nav>
        </div>
                
    </div>
    <div class="bol-fluid-container bol-body-height">
        <div class="bol-container block-main-content">
            {% block content %}
            {% endblock %}
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById('slot-container');
        let offset = 0;
        const limit = 20;
        let loading = false;
        let allLoaded = false;

        async function loadSlots() {
            if (loading || allLoaded) return;

            loading = true;
            try {
            const response = await fetch(`/slots/chunk/?offset=${offset}&limit=${limit}`);
            const data = await response.json();

            if (data.slots.length === 0) {
                allLoaded = true;
                return;
            }

            data.slots.forEach(slot => {
                const button = document.createElement('button');
                button.className = `slot-btn ${slot.claimed ? 'taken' : 'available'}`;
                button.disabled = slot.claimed;
                button.dataset.slot = slot.slot_number;
                button.innerHTML = `
                ${slot.slot_number}<br>
                ${!slot.claimed ? `<span style="color:#2A9DF4;font-weight:bold;">${slot.price}</span>` : ''}
                `;
                container.appendChild(button);
            });

            offset += limit;
            loading = false;
            } catch (err) {
            console.error('Error loading slots:', err);
            loading = false;
            }
        }

        // Initial load
        loadSlots();

        // Infinite scroll
        window.addEventListener('scroll', () => {
            const bottomReached = window.innerHeight + window.scrollY >= document.body.offsetHeight - 100;
            if (bottomReached) loadSlots();
        });
        });
    </script>

</body>
</html>